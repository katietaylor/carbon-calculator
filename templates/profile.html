{% extends 'base.html' %}

{% block title %} Profile {% endblock %}

{% block content %}

<h1>{{ name }}'s Profile </h1>

<!-- Residence ############################################################ -->

<h2>Residences</h2>
{% if residences %}
    <table>
        <tr>
            <th>House Name or Address</th>
            <th>Zipcode</th> 
            <th>Residents</th>
            <th>Default</th>
        </tr>
        {% for residence in residences %}
        <tr>
            <th>{{ residence.name_or_address }}</th>
            <th>{{ residence.zipcode_id }}</th>
            <th>{{ residence.number_of_residents }}</th>
            <th>{{ residence.is_default }}</th>
        </tr>
        {% endfor %}
    </table>
{% else %}
    <h2>No residences added</h2>
{% endif %}
<br>

<form action="/add-residence" method="POST">
    House Name or Address: <input type="text" name="name_or_address"> <br>
    zipcode: <input type="text" name="zipcode"> <br>
    number of residents? <input type="text" name="no_residents"> <br>
    set as default?: <input type="checkbox" name="default"> <br>

    <input type="submit" value="Add Residence">
</form>

<!-- Cars ################################################################# -->

<h2>Cars</h2>
{% if usercars %}
    <table>
        <tr>
            <th>Make</th>
            <th>Model</th> 
            <th>Year</th>
            <th>Default</th>
        </tr>
        {% for usercar in usercars %}
        <tr>
            <th>{{ usercar.car.make }}</th>
            <th>{{ usercar.car.model }}</th>
            <th>{{ usercar.car.year }}</th>
            <th>{{ usercar.is_default }}</th>
        </tr>
        {% endfor %}
    </table>
{% else %}
    <h2>No cars added</h2>
{% endif %}
<br>

<form action="/add-car", id="add-car" method="POST">
    Make: <select name="make", id="make">
        <option selected="selected", disabled="disabled">Select a Car Make</option>
    {% for make in makes %}
        <option value="{{ make }}">{{ make }}</option>
    {% endfor %}
    </select><br>
    Model: <select name="model", id="model">

    </select><br>
    Year: <select name="year", id="year">
 
    </select><br>
    set as default?: <input type="checkbox" name="default"> <br>

    <input type="submit" value="Add Car">
</form>

<script type="text/javascript">
    "use strict";

    var make = $("#make");
    var model = $("#model");
    var year = $("#year");

    make.on("change", getModelYearList);
    model.on("change", getModelYearList);
    year.on("change", getModelYearList);

    function getModelYearList(evt) {
        var data = {};
        data.make = make.val()

        if (model.val()) {
            data.model = model.val();
        }
        if (year.val()) {
            data.year = year.val();
        }

        $.ajax({
            url: "/car-data",
            data: data,
            success: function(data) {
                model.empty();
                model.append("<option value='', disabled='disabled'>SELECT MODEL</option>");
                $.each(data, function(i,car) {
                    console.log(car)
                    if ($.inArray(car.model, model) == -1) {
                        model.append("<option value='"+car.model+"'>"+car.model+"</option>");
                    }
                })
                // iterate over list of cars, 
                // clear out old options list
                // create model options
                
            },
            error: function(data) {

            }
        })
    }

    // function showModelList


</script>


{% endblock %}